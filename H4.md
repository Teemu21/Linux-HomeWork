# H4 - Aikajana

## By Teemu Koskinen

## a) Captain obvious. Linuxissa on paketinhallinta, joten ohjelmien asentaminen on yksinkertaista. Tee tila, joka asentaa 10 suosikkiohjelmaasi paketinhallinnasta. Tässä a-kohdassa voit jättää ohjelmat oletusasetuksille.

Aloitetaas tämä tehtävällä sillä, että luodaan tälle tilalle oma kansio Salttiin.

	/srv/salt$ sudo mkdir top10 
	$ ls
	apache  bash  sshd  sshd_config  top10
	$ cd top10
	/top10$ 
	
Nyt kun kansio on tehty niin pitäisi alkaa miettimään, että mitä ohjelmia tällä voisi asentaa. Koneelle voisi testi mielessä asentaa ainakin apachen, SSH:n ja bash-completionin. Vielä pitäisi keksiä 7 muuta ohjelmaa. Micron voisi ainakin asentaa sillä sehän ei ole Debian distroissa valmiiksi asennettuna. UFW:n vois myös asentaa. Libreoffice ja GIMP vois olla kans hyviä ehdokkaita. Wgetin ja snapin voisi asentaa siksi, että jos joskus tarvitsee jotain jota ei löydy Debianin perus paketinhallinnasta ja nethackin pelaamista varten.

Tehdääs siis komento, joka asentaa koneelle:

- apache2
- ssh
- bash-completion
- wget
- snap
- micro
- ufw
- libreoffice
- gimp
- nethack

Tein siis tälläisen init.sls tiedoston:

![top10](init.png)

Testataas nyt sitten tätä aiemmin luotua komentoa.

	$ sudo salt-call --local state.apply top10
	local:
	----------
	          ID: apache2
	    Function: pkg.installed
	      Result: True
	     Comment: All specified packages are already installed
	     Started: 18:26:19.644621
	    Duration: 101.602 ms
	     Changes:   
	----------
	          ID: ufw
	    Function: pkg.installed
	      Result: True
	     Comment: All specified packages are already installed
	     Started: 18:26:19.746468
	    Duration: 7.545 ms
	     Changes:   
	----------
	          ID: ssh
	    Function: pkg.installed
	      Result: True
	     Comment: All specified packages are already installed
	     Started: 18:26:19.754138
	    Duration: 7.253 ms
	     Changes:   
	----------
	          ID: wget
	    Function: pkg.installed
	      Result: True
	     Comment: All specified packages are already installed
	     Started: 18:26:19.761517
	    Duration: 8.113 ms
	     Changes:   

	  ID: snapd
    Function: pkg.installed
      Result: True
     Comment: The following packages were installed/updated: snapd
     Started: 18:26:19.769759
    Duration: 16325.735 ms
     Changes:   
              ----------
              snapd:
                  ----------
                  new:
                      2.49-1+deb11u1
                  old:
              squashfs-tools:
                  ----------
                  new:
                      1:4.4-2+deb11u2
                  old:
	----------
          ID: micro
    Function: pkg.installed
      Result: True
     Comment: The following packages were installed/updated: micro
     Started: 18:26:36.100886
    Duration: 4162.936 ms
     Changes:   
              ----------
              micro:
                  ----------
                  new:
                      2.0.8-1+b6
                  old:
              xclip:
                  ----------
                  new:
                      0.13-2
                  old:
	----------
          ID: gimp
    Function: pkg.installed
      Result: True
     Comment: The following packages were installed/updated: gimp
     Started: 18:26:40.269117
    Duration: 16017.033 ms
     Changes:   

	       ID: libreoffice
    Function: pkg.installed
      Result: True
     Comment: The following packages were installed/updated: libreoffice
     Started: 18:26:56.291774
    Duration: 96813.065 ms
     Changes:   

	         ID: bash-completion
    Function: pkg.installed
      Result: True
     Comment: All specified packages are already installed
     Started: 18:28:33.110388
    Duration: 753.812 ms
     Changes:   
	----------
          ID: nethack-console
    Function: pkg.installed
      Result: True
     Comment: The following packages were installed/updated: nethack-console
     Started: 18:28:33.864352
    Duration: 6110.111 ms
     Changes:   
              ----------
              nethack-common:
                  ----------
                  new:
                      3.6.6-2+b1
                  old:
              nethack-console:
                  ----------
                  new:
                      3.6.6-2+b1
                  old:

	Summary for local
	-------------
	Succeeded: 10 (changed=5)	
	Failed:     0
	-------------
	Total states run:     10
	Total run time:  140.307 s

Kaikki kymmenen komentoa onnistui ja viisi muutosta tehtiin. Jännä kyllä, että se asensi micron vaikkakin minulla on ollut se jo käytössä.

## b) CSI Pasila. Tiedostoista saa aikajanan 'cd /etc/; sudo find -printf '%T+ %p\n'|sort|tail'.

Anna esimerkki aikajanasta
Selitä jokainen kohta komennosta, jolla aikajana tehdään. Vinkki: '%T+' löytyy 'man find' kohdasta printf.
Aja jokin komento, joka muuttaa järjestelmän yhteisiä asetustiedostoja
Ota uusi aikajana ja etsi muutos sieltä
Onko samalla hetkellä muutettu yhtä vai useampaa tiedostoa?

Aloitetaas sillä, että tehdään tuo aikajana komento kuten ohjeessa näkyy ja katsotaan mitä tapahtuu.

	$ cd /etc/
	$ sudo find -printf '%T+ %p\n'|sort|tail
	2022-04-23+18:28:39.3747487650 ./nethack
	2022-04-23+18:28:39.3987487660 ./alternatives/nethack
	2022-04-23+18:28:39.4027487660 ./alternatives
	2022-04-23+18:28:39.6867487740 ./mailcap
	2022-04-23+19:57:27.0268961790 ./cups/subscriptions.conf.O
	2022-04-24+06:15:44.1619535570 ./resolv.conf
	2022-04-24+06:15:44.1659535570 .
	2022-04-24+06:15:53.7139538220 ./cups
	2022-04-24+06:15:53.7139538220 ./cups/subscriptions.conf
	2022-04-24+06:20:21.9699612440 ./apt/trusted.gpg.d/google-chrome.gpg
	
Katsotaan seuraavaksi mitä man find sivu osaa kertoa meille tästä aikajana komennosta.

- find: Tämä on pääkomento, jolla voi etsiä kaikenlaista.
- -printf: Tämä tulostaa mitä find on löytänyt näyttäen kaikki tiedostot terminaalissa.
- %T: Tämä näyttää ajan milloin tiedostot on tehty tai niitä on viimeksi muokattu.
- %p: Tämä näyttää tiedoston nimen.
- \n: Tämä luo uuden rivin.
- sort: Tämä erottelee tulokset seuraavan komennon mukaan, joka on toisen putken jälkeen.
- tail: Näyttää hännän eli viimeisimmät muutokset.

Laitoin tässä kohtaa testiksi tuon micron softwrapin pois päältä niin katsotaan seuraavaksi tuliko aikajaan muutoksia.

	$ cd /etc/
	$ sudo find -printf '%T+ %p\n'|sort|tail 
	2022-04-23+18:28:39.3747487650 ./nethack
	2022-04-23+18:28:39.3987487660 ./alternatives/nethack
	2022-04-23+18:28:39.4027487660 ./alternatives
	2022-04-23+18:28:39.6867487740 ./mailcap
	2022-04-23+19:57:27.0268961790 ./cups/subscriptions.conf.O
	2022-04-24+06:15:44.1619535570 ./resolv.conf
	2022-04-24+06:15:44.1659535570 .
	2022-04-24+06:15:53.7139538220 ./cups
	2022-04-24+06:15:53.7139538220 ./cups/subscriptions.conf
	2022-04-24+06:20:21.9699612440 ./apt/trusted.gpg.d/google-chrome.gpg
	
Näemmä micron asetusten muuttamsita ei lasketa järjestelmän asetusten muuttamiseksi. Katsotaas sitten netistä, jos löytyisi se komento, jolla promptin sai näyttämään vain viimeisimmän kansion eikä koko kansiohakemsitoa alaken käyttäjästä ja koneesta.

Netistä löytyi tälläinen sivusto:[Techglimpse.com](https://techglimpse.com/shorten-bash-prompt-linux/) ja siellä metodi neljä vaikutti tutulta: PS1="[\W]\\$ ".

Kokeillaas tota komentoa seuraavaksi.

	[~]$ cd /etc/
	[etc]$ sudo find -printf '%T+ %p\n'|sort|tail
	2022-04-23+18:28:39.3747487650 ./nethack
	2022-04-23+18:28:39.3987487660 ./alternatives/nethack
	2022-04-23+18:28:39.4027487660 ./alternatives
	2022-04-23+18:28:39.6867487740 ./mailcap
	2022-04-23+19:57:27.0268961790 ./cups/subscriptions.conf.O
	2022-04-24+06:15:44.1619535570 ./resolv.conf
	2022-04-24+06:15:44.1659535570 .
	2022-04-24+06:15:53.7139538220 ./cups
	2022-04-24+06:15:53.7139538220 ./cups/subscriptions.conf
	2022-04-24+06:20:21.9699612440 ./apt/trusted.gpg.d/google-chrome.gpg
	
Tämän pitäisi kyllä olla jo järjestelmä kohtainen asetus, jotenka on outoa, että sitä ei mukamas löydy /etc/ alta.

Kaivelin ny näitä aikajanoja ja ottamalla jopa ton tailin tuolta lopusta pois, mutta en löytänyt tota promptin muutosta mistään. Katsotaas jos jotain muuta voisi muutella joka aiheuttaisi muutoksen aikajanalle. 

Laitoin nyt sitten sudo a2dismod userdir komennon päälle ja käynnistin Apachen uudelleen niin nyt näkyy tämä muutos aikajanassa.

	2022-04-24+08:24:14.6109810970 ./cups
	2022-04-24+08:32:46.6109610430 ./apache2/mods-enabled

Vaikuttaa siltä, että /ect:n alla on muutettu vain näitä Apachen asetuksia eikä muita asetuksia ole muutettu ainakaan samaan aikaan.

## c) Tiedän mitä teit viime kesän^H^H^H komennolla. Säädä jotain ohjelmaa ja etsi sen muuttamat tiedostot aikajanasta. Tee sitten tästä oma Saltin tila.

Vinkki: tässä kohdassa pitää muuttaa jonkin ohjelman asetuksia, pelkkä ohjelman asennus pkg.installed on liian helppoa.

## d) Asenna jokin toinen ohjelma asetuksineen.

Vinkki: tässäkin kohdassa edellytetään asetusten muuttamista. Jos haluat, voit valita erilaisen ohjelman kuin c-kohdassa. Esimerkiksi jos asensit c-kohdassa demonin, voit asentaa tässä komentoriviohjelman tai graafisen käyttöliittymän ohjelman.
